このMCPサーバーでは以下のツールが利用できます。

### 検索関連（認証なしで利用可能）
- **search-notes**: キーワードで記事を検索（ソート順は `sort` パラメータで指定可能）
- **search-all**: note全体検索（ユーザー、ハッシュタグ、記事など）
- **analyze-notes**: 記事の詳細分析（競合分析、エンゲージメント分析、コンテンツタイプ分析など）

### 記事関連（認証なしで利用可能）
- **get-note**: 記事IDから詳細情報を取得（下書き記事も取得可能）
- **get-category-notes**: カテゴリーの記事一覧を取得

### ユーザー関連（認証なしで利用可能）
- **search-users**: ユーザーを検索
- **get-user**: ユーザー詳細情報を取得
- **get-user-notes**: ユーザーの記事一覧を取得

### マガジン関連（認証なしで利用可能）
- **search-magazines**: マガジンを検索
- **get-magazine**: マガジンの詳細を取得

### 自分の記事関連（認証必須）
- **get-my-notes**: 自分の記事一覧（下書き含む）を取得
- **post-draft-note**: 下書き記事を投稿・更新
- **open-note-editor**: 記事の編集ページURLを生成

### インタラクション（認証必須）
- **get-comments**: 記事のコメント一覧を取得（認証なしでも可能なケースあり）
- **post-comment**: 記事にコメントを投稿
- **get-likes**: 記事のスキ一覧を取得（認証なしでも可能なケースあり）
- **like-note**: 記事にスキをつける
- **unlike-note**: 記事のスキを削除

### 統計（認証必須）
- **get-stats**: PV統計情報を取得

### メンバーシップ関連（認証必須）
- **get-membership-summaries**: 加入済みメンバーシップ一覧を取得
- **get-membership-plans**: メンバーシッププラン情報を取得
- **get-membership-notes**: メンバーシップの記事一覧を取得

## 制限事項と注意点

このMCPサーバーには以下の制限事項があります。

### APIの制限

- **下書き保存機能（post-draft-note）**: まだ未実装です。

- **検索結果の上限**: 単一の検索リクエストで取得できる結果は最大20件程度です。より多くの結果を取得する場合は、`start`パラメータを使用してページネーションを行ってください。

- **認証情報の更新**: Cookieベースの認証を使用している場合、Cookieの有効期限（1～2週間程度）が切れると認証が必要な機能が使えなくなります。定期的にCookie値を更新するか、ログイン認証を利用してください。

### 機能の制限

- **analyze-notes ツール**: 記事の詳細分析機能は、note.com APIが提供するデータに基づいています。一部の分析指標（例：実際の閲覧数など）は、APIから提供されない場合は利用できません。

- **ソートパラメータ**: `sort`パラメータでは、`new`（新着順）、`popular`（人気順）、`hot`（急上昇）の3種類のソートが利用できますが、note.comのAPI変更により、一部のソートオプションが機能しない場合があります。

- **get-my-notes**: 下書き記事の取得については、note.comのAPI実装によっては一部の情報が取得できない場合があります。

- **edit-note/publish-note**: 下書き編集や公開機能を使用するには、`NOTE_GQL_AUTH_TOKEN`の設定が必要です。このトークンが設定されていない場合、編集時に認証エラーが発生します。

### 下書き編集機能の利用方法

記事の下書き編集や公開機能を使用するための手順：

1. note.comにログインします
2. ブラウザの開発者ツール（Chromeの場合は F12 キーまたは右クリックから「調査」）を開きます
3. 「Application」または「Storage」タブを選択し、左側のメニューから「Cookies」→「https://note.com」を選択します
4. リストから「note_gql_auth_token」を探し、その値をコピーします
5. `.env`ファイルに以下の行を追加します：
   ```
   NOTE_GQL_AUTH_TOKEN=コピーしたトークン値
   ```
6. MCPサーバーを再起動して変更を反映させます

認証トークンが正しく設定されれば、下書き編集機能が正常に動作します。

### 新機能の使用例

#### 記事詳細分析ツールの例

```
// 基本的な使用例
analyze-notes(query: "ChatGPT")

// 詳細なオプション指定
analyze-notes(
  query: "AIツール", 
  size: 30, 
  sort: "popular", 
  includeUserDetails: true,
  analyzeContent: true,
  priceRange: "paid"
)

// カテゴリと日付範囲の指定
analyze-notes(
  query: "プログラミング", 
  category: "technology",
  dateRange: "3m",  // 3ヶ月以内
  sort: "new"
)
```

#### ソートパラメータの使用例

```
// 新着順で記事を検索
search-notes(query: "AI", sort: "new")

// 人気順で全体検索
search-all(query: "プログラミング", context: "user,hashtag,note", sort: "popular")

// 急上昇（デフォルト）で検索
search-notes(query: "ChatGPT")
```

## トラブルシューティング

### サーバーが起動しない
- `.env`ファイルが正しく作成され、設定されているか確認してください。`.env.example` をコピーして `.env` を作成し、必要な認証情報が入力されているか確認します。
- Node.jsのバージョンが18以上か確認してください（`node -v`コマンドで確認）。
- 依存パッケージがインストールされているか確認してください（`npm install`を実行）。
- `npm run build`でTypeScriptが正しくビルドできているか確認してください（`npm run start` で本番用サーバーを起動する場合）。

### 認証エラーが発生する
- `.env` ファイルに設定した認証情報（メールアドレス/パスワード、またはCookie値、ユーザーID）が正しいか、最新か確認してください。
- Cookie認証の場合、有効期限が切れている可能性があります。
- 認証が必要な機能であるか確認してください。
- 下書き編集機能でエラーが発生する場合は、`NOTE_GQL_AUTH_TOKEN`の設定が必要です。note.comにログインし、開発者ツールでCookieから`note_gql_auth_token`の値を取得して設定してください。

### APIエラーが発生する
- note.comのAPI仕様が変更された可能性があります。
- 最新版のサーバーコードを確認するか、エラーが発生した箇所のコードを見直してください。

### デバッグログを確認したい
- デバッグログを有効にするには、プロジェクトルートにある `.env` ファイルに以下の行を追記してください:
  ```env
  DEBUG=true
  ```
- `.env` ファイルが存在しない場合は、上記のインストール手順に従い `.env.example` から作成してください。

### 開発者向け：高速開発モード
リファクタリング版では以下の開発スクリプトが利用できます：

```bash
# TypeScriptファイルを直接実行（ビルド不要、最速）
npm run dev

# ファイル変更を監視して自動的に再ビルド・再起動（開発時に便利）
npm run dev:watch 

# 本番用にビルドして起動
npm run start
```

### モジュールの個別テスト
各モジュールは独立しているため、個別にテスト・デバッグできます（パスは適宜調整してください）：

```bash
# 特定のモジュールをNode.jsで直接実行（ビルド後）
node build/utils/api-client.js 
node build/tools/search-tools.js
```


## 注意事項

- このサーバーはnote.comの非公式APIを利用しています
- APIの仕様変更により、一部または全部の機能が動作しなくなる可能性があります
- Cookie認証は有効期限があるため、定期的に更新が必要ですが、ログイン認証で定期的にトークンは更新できる様にしています。
- note.comの利用規約を遵守して使用してください
- まだまだ発展途上のため、エラー等あるかもしれません。ぜひ見つけたらissueで教えてください。

## ライセンス

MIT
